@model Shop.Models.DanhGia

<!-- Captcha -->
@using BotDetect.Web.Mvc
@using BotDetect.Web.UI
<link href="@BotDetect.Web.CaptchaUrls.Absolute.LayoutStyleSheetUrl" rel="stylesheet" type="text/css" />

@{
    MvcCaptcha commentCaptcha = new MvcCaptcha("commentCaptcha");
    commentCaptcha.UserInputID = "CaptchaCode";
}

@using Shop.Common
@using (Html.BeginForm("NhanXet", "Home", FormMethod.Post, new { id = "reviewForm" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(false, "", new { @class = "text-danger" })

    <!-- Hiển thị thông báo từ server -->
    if (TempData["Notification"] != null)
    {
        <div class="mb-3 alert @(TempData["NotificationType"] ?? "alert-info")">
            @TempData["Notification"]
        </div>
    }

    <!-- Kiểm tra đăng nhập -->
    if (Session["TaiKhoan"] == null)
    {
        <div class="mb-3">
            <p class="text-danger">Vui lòng <a href="@Url.Action("Login", "Account", new { returnUrl = Request.Url.ToString() })">đăng nhập</a> để gửi đánh giá.</p>
        </div>
    }
    else
    {
        var user = (Shop.Models.AspNetUser)Session["TaiKhoan"];
        <div class="mb-3">
            @Html.Hidden("ten", user.UserName)
            <p>Họ tên: <strong>@user.UserName</strong></p>
        </div>

        <div class="mb-3">
            <textarea name="noidung" class="form-control" placeholder="Thêm đánh giá..."></textarea>
            @Html.ValidationMessageFor(model => model.noidung, "", new { @class = "text-danger" })
        </div>

        <div class="mb-3">
            <div class="d-flex ratings justify-content-end flex-row-reverse">
                <input type="radio" value="5" name="vote" id="rating-5"><label for="rating-5"></label>
                <input type="radio" value="4" name="vote" id="rating-4"><label for="rating-4"></label>
                <input type="radio" value="3" name="vote" id="rating-3"><label for="rating-3"></label>
                <input type="radio" value="2" name="vote" id="rating-2"><label for="rating-2"></label>
                <input type="radio" value="1" name="vote" id="rating-1" checked><label for="rating-1"></label>
            </div>
        </div>

        <div class="mb-3">
            @Html.Captcha(commentCaptcha)
            @Html.TextBox("CaptchaCode")
        </div>

        <div class="mb-3">
            <button type="submit" class="btn btn-outline-dark">Gửi</button>
        </div>
    }
}

<script>
    // Xử lý thông báo thành công
    @if (TempData["SuccessRedirect"] != null)
    {
        @:window.location.href = '@TempData["SuccessRedirect"]';
    }
</script>